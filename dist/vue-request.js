import merge from"lodash.merge";export default{install:function(t,e){this.$createElement;var n=merge({},{axiosDefaults:{timeout:1e4,retry:3,withCredentials:!0},withXHR:!0,componentName:"Loading",status:{},fallBack:function(){alert(this.fallBackText)},fallBackText:"Hubo un problema al comunicarse con el servicio, por favor revise su conexión o reintente más tarde",fallBackTimeOut:15e3,request:[],response:[]},e),r=n.axios,o=n.axiosDefaults,a=n.fallBack,s=n.componentName;if(!r)throw new Error("This plugins needs an axios instance assigned as 'axios'");n.withXHR&&(r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"),merge(r.defaults,o);var i={loading:!1,loadCount:0,block:!1,configs:new Map,event:new t};s&&t.component(s,(function(){return Promise.resolve({name:s,props:{transition:{type:String,default:"fade"},color:{type:String,default:"rgba(255, 255, 255, 0.5)"}},data:function(){return{state:i}},render:function(){var t=arguments[0];return t("transition",{attrs:{name:this.transition}},[t("div",{directives:[{name:"show",value:this.state.loading}],class:"__ITDModal",style:{"background-color":this.color}},[this.$slots.default?this.$slots.default:t("h1",["Waiting slot here"])])])}})}));var c=function(){i.loadCount--,i.loadCount<=0&&(i.loadCount=0,i.loading=!1)};r.interceptors.request.use((function(t){return t.noBlock||(i.loading=!0,i.loadCount++),t.try=t.try||1,t})),r.interceptors.response.use((function(t){return c(),t.body=t.data,t}),(function(t){var e=t.config,o=t.response;if(e.try++,e.noBlock||c(),o){if(o.body=o.data,"".concat(o.status)in n.status){if("retry"!==n.status["".concat(o.status)])return n.status[o.status](e,o);if(e.try<=e.retry)return r(e)}return Promise.reject(t)}if(e.try<=e.retry)return r(e);e.try=1;var s=new Promise((function(t){var n=e.url,r=e.method,o=e.params,a=e.body,s="".concat(n).concat(r).concat(JSON.stringify(o)).concat(JSON.stringify(a));i.configs.set(s,e),i.event.$once(s,(function(e){t(e)}))}));return i.lock||(i.lock=!0,Promise.resolve(a()).then((function(){i.lock=!1,i.configs.forEach((function(t,e){r(t).then((function(t){i.configs.delete(e),i.event.$emit(e,t)}))}))}))),s})),n.request.forEach((function(t){return r.interceptors.request.use[Array.isArray(t)?"apply":"call"](r,t)})),n.response.forEach((function(t){return r.interceptors.response.use[Array.isArray(t)?"apply":"call"](r,t)})),t.prototype.$http=r}};